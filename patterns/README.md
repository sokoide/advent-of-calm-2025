# CALM Patterns

このディレクトリには、共通の構成を定義し強制するための CALM (Common Architecture Language Model) パターンが含まれています。

## 1. パターンとは何か
CALM パターンは、アーキテクチャ設計における**「生成 (Generation)」**と**「バリデーション (Validation)」**という2つの強力な役割（スーパーパワー）を持っています。

*   **生成**: パターンをテンプレートとして使用し、標準に準拠した新しいアーキテクチャファイルを即座に生成できます。
*   **バリデーション**: 作成されたアーキテクチャが組織の標準構造（ノード数、接続の向き、プロトコルなど）に従っているかを厳格にチェックします。

## 2. Web アプリケーションパターン (`web-app-pattern.json`)
このパターンは、標準的な 3層 Web アプリケーションの基本構造を定義しています。

### 使用方法

#### アーキテクチャの生成
パターンから新しいアーキテクチャファイルの雛形を作成します。
```bash
calm generate -p patterns/web-app-pattern.json -o architectures/my-new-app.json
```

#### アーキテクチャのバリデーション
既存のファイルがパターンに適合しているか検証します。
```bash
calm validate -p patterns/web-app-pattern.json -a architectures/generated-webapp.json
```

## 3. パターンによる強制事項
このディレクトリには、性質の異なる2つのパターンが含まれています。

### Web アプリケーションパターン (`web-app-pattern.json`) - **構造の強制**
このパターンは、システムの「トポロジー（形）」を定義します。
*   **強制事項**: 特定の名前と型を持つ 3つのノードと、それらの間の特定の接続。
*   **用途**: 標準的な 3層構造の Web アプリを迅速に立ち上げ、その形を維持したい場合。

### 会社基本パターン (`company-base-pattern.json`) - **品質（標準）の強制**
このパターンは、個別の構成には干渉せず、存在するすべての要素が組織の「ガバナンス基準」を満たしているかをチェックします。
*   **強制事項**: ノード数に関わらず、すべてのノードに `costCenter` / `owner` があり、すべての接続に `dataClassification` / `encrypted` が定義されていること。
*   **用途**: あらゆる種類のアーキテクチャに対して、組織としての最低限の品質基準を横断的に適用したい場合。

## 4. どちらのパターンを使うべきか
| 目的 | 推奨パターン |
| :--- | :--- |
| 新しい 3-tier アプリの雛形を作りたい | `web-app-pattern.json` |
| 既存の（形がバラバラな）設計が会社のルールを守っているか確認したい | `company-base-pattern.json` |
| 両方を守らせたい | 両方のパターンで個別に `validate` を実行します。 |

## 5. 組織標準によるバリデーションの実行
外部参照される Standards ファイルをローカルファイルにマッピングするため、`-u` (URL mapping) フラグを併用します。

```bash
calm validate -p patterns/company-base-pattern.json \
              -a architectures/ecommerce-platform.json \
              -u url-mapping.json
```

## 6. カスタマイズ可能な柔軟性
パターンの制約を満たした上で、以下の項目は自由に拡張可能です：
*   **詳細説明**: 各ノードやリレーションシップの `description`
*   **インターフェース**: ホスト名、ポート、プロトコルの詳細設定
*   **メタデータ**: 所有者、リポジトリURL、運用情報、タグ
*   **コントロール**: セキュリティ、パフォーマンス、可用性の要件
