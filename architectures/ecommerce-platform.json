{
    "$schema": "https://calm.finos.org/release/1.1/meta/calm.json",
    "adrs": [
        "docs/adr/0001-use-message-queue-for-async-processing.md",
        "docs/adr/0002-use-oauth2-for-api-authentication.md"
    ],
    "unique-id": "ecommerce-platform-architecture",
    "name": "E-Commerce Order Processing Platform",
    "description": "A complete architecture for an e-commerce order processing system.",
    "metadata": {
        "owner": "Architecture Team",
        "version": "1.0.0",
        "created": "2025-12-26",
        "description": "E-commerce order processing platform architecture demo.",
        "tags": ["ecommerce", "microservices", "orders"]
    },
    "controls": {
        "security": {
            "description": "Data encryption and secure communication requirements",
            "requirements": [
                {
                    "requirement-url": "https://internal-policy.example.com/security/encryption-at-rest",
                    "config": {
                        "algorithm": "AES-256",
                        "scope": "all-data-stores"
                    }
                },
                {
                    "requirement-url": "https://internal-policy.example.com/security/tls-1-3-minimum",
                    "config-url": "https://configs.example.com/security/tls-config.yaml"
                }
            ]
        },
        "performance": {
            "description": "System-wide performance and scalability requirements",
            "requirements": [
                {
                    "requirement-url": "https://internal-policy.example.com/performance/response-time-sla",
                    "config": {
                        "p99-latency-ms": 200,
                        "p95-latency-ms": 100
                    }
                },
                {
                    "requirement-url": "https://internal-policy.example.com/performance/availability-target",
                    "config-url": "https://configs.example.com/infra/ha-config.yaml"
                }
            ]
        },
        "high-availability": {
            "description": "System-wide uptime and availability requirements",
            "requirements": [
                {
                    "requirement-url": "https://internal-policy.example.com/resilience/availability-sla",
                    "config": {
                        "uptime-percentage": 99.9,
                        "monitoring-interval-seconds": 60
                    }
                }
            ]
        }
    },
    "flows": [
        {
            "unique-id": "order-processing-flow",
            "name": "Customer Order Processing",
            "description": "End-to-end flow from customer placing an order to payment confirmation",
            "transitions": [
                {
                    "relationship-unique-id": "customer-interacts-lb",
                    "sequence-number": 1,
                    "description": "Customer submits order via Load Balancer",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "lb-connects-gateway-1",
                    "sequence-number": 2,
                    "description": "LB routes to Gateway 1",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "gateway-1-connects-order",
                    "sequence-number": 3,
                    "description": "Gateway 1 routes to Order Service",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "order-publishes-to-queue",
                    "sequence-number": 4,
                    "description": "Order Service publishes payment task",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "payment-subscribes-to-queue",
                    "sequence-number": 5,
                    "description": "Payment Service processes task from queue",
                    "direction": "source-to-destination"
                }
            ]
        },
        {
            "unique-id": "inventory-check-flow",
            "name": "Inventory Stock Check",
            "description": "Admin checks and updates inventory stock levels",
            "transitions": [
                {
                    "relationship-unique-id": "admin-interacts-lb",
                    "sequence-number": 1,
                    "description": "Admin requests inventory status via LB",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "lb-connects-gateway-2",
                    "sequence-number": 2,
                    "description": "LB routes to Gateway 2",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "gateway-2-connects-inventory",
                    "sequence-number": 3,
                    "description": "Gateway 2 routes to inventory service",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "inventory-connects-db",
                    "sequence-number": 4,
                    "description": "Query current stock levels",
                    "direction": "source-to-destination"
                },
                {
                    "relationship-unique-id": "inventory-connects-db",
                    "sequence-number": 5,
                    "description": "Return stock data",
                    "direction": "destination-to-source"
                }
            ]
        }
    ],
    "nodes": [
        {
            "unique-id": "customer",
            "node-type": "actor",
            "name": "Customer",
            "description": "A user who browses and purchases products."
        },
        {
            "unique-id": "admin",
            "node-type": "actor",
            "name": "Admin",
            "description": "A staff member who manages products and orders."
        },
        {
            "unique-id": "ecommerce-system",
            "node-type": "system",
            "name": "E-Commerce Platform",
            "description": "The overall e-commerce system containing microservices."
        },
        {
            "unique-id": "load-balancer",
            "node-type": "service",
            "name": "Load Balancer",
            "description": "High-availability entry point that distributes traffic to API Gateways.",
            "metadata": {
                "tech-owner": "Network Team",
                "deployment-type": "managed-service",
                "business-criticality": "high",
                "ha-enabled": true
            },
            "interfaces": [
                {
                    "unique-id": "lb-https",
                    "name": "Public HTTPS Interface",
                    "protocol": "HTTPS",
                    "host": "api.shop.example.com",
                    "port": 443
                },
                {
                    "unique-id": "lb-to-gateway",
                    "protocol": "HTTP",
                    "description": "Outbound to API Gateways"
                }
            ]
        },
        {
            "unique-id": "api-gateway-1",
            "node-type": "service",
            "name": "API Gateway Instance 1",
            "description": "Primary API Gateway instance.",
            "metadata": {
                "tech-owner": "Edge Team",
                "repository": "https://github.com/example/api-gateway",
                "deployment-type": "container",
                "business-criticality": "high"
            },
            "controls": {
                "performance": {
                    "description": "API Gateway rate limiting and caching requirements",
                    "requirements": [
                        {
                            "requirement-url": "https://internal-policy.example.com/performance/rate-limiting",
                            "config-url": "https://configs.example.com/gateway/rate-limits.yaml"
                        },
                        {
                            "requirement-url": "https://internal-policy.example.com/performance/caching-policy",
                            "config": {
                                "default-ttl-seconds": 300,
                                "cache-control": "private"
                            }
                        }
                    ]
                }
            },
            "interfaces": [
                {
                    "unique-id": "gateway-1-http",
                    "name": "HTTP Interface",
                    "protocol": "HTTP",
                    "port": 80
                },
                {
                    "unique-id": "order-client-1",
                    "protocol": "REST"
                },
                {
                    "unique-id": "inventory-client-1",
                    "protocol": "REST"
                },
                {
                    "unique-id": "gateway-1-health",
                    "name": "Health Check",
                    "protocol": "HTTP",
                    "path": "/health"
                }
            ]
        },
        {
            "unique-id": "api-gateway-2",
            "node-type": "service",
            "name": "API Gateway Instance 2",
            "description": "Secondary API Gateway instance for high availability.",
            "metadata": {
                "tech-owner": "Edge Team",
                "repository": "https://github.com/example/api-gateway",
                "deployment-type": "container",
                "business-criticality": "high"
            },
            "controls": {
                "performance": {
                    "description": "API Gateway rate limiting and caching requirements",
                    "requirements": [
                        {
                            "requirement-url": "https://internal-policy.example.com/performance/rate-limiting",
                            "config-url": "https://configs.example.com/gateway/rate-limits.yaml"
                        },
                        {
                            "requirement-url": "https://internal-policy.example.com/performance/caching-policy",
                            "config": {
                                "default-ttl-seconds": 300,
                                "cache-control": "private"
                            }
                        }
                    ]
                }
            },
            "interfaces": [
                {
                    "unique-id": "gateway-2-http",
                    "name": "HTTP Interface",
                    "protocol": "HTTP",
                    "port": 80
                },
                {
                    "unique-id": "order-client-2",
                    "protocol": "REST"
                },
                {
                    "unique-id": "inventory-client-2",
                    "protocol": "REST"
                },
                {
                    "unique-id": "gateway-2-health",
                    "name": "Health Check",
                    "protocol": "HTTP",
                    "path": "/health"
                }
            ]
        },
        {
            "unique-id": "order-service",
            "node-type": "service",
            "name": "Order Service",
            "description": "Handles order creation and lifecycle management.",
            "metadata": {
                "tech-owner": "Order Team",
                "repository": "https://github.com/example/order-service",
                "deployment-type": "container",
                "sla-tier": "tier-1",
                "business-criticality": "high"
            },
            "controls": {
                "circuit-breaker": {
                    "description": "Fault tolerance for downstream service calls",
                    "requirements": [
                        {
                            "requirement-url": "https://internal-policy.example.com/resilience/circuit-breaker-policy",
                            "config": {
                                "failure-threshold-percentage": 50,
                                "wait-duration-seconds": 30,
                                "minimum-calls-before-opening": 10
                            }
                        }
                    ]
                }
            },
            "interfaces": [
                {
                    "unique-id": "order-api",
                    "name": "Order API",
                    "protocol": "REST",
                    "port": 8080
                },
                {
                    "unique-id": "order-db-write-client",
                    "name": "Order DB Write Client",
                    "protocol": "JDBC",
                    "description": "Writes to the primary database."
                },
                {
                    "unique-id": "order-db-read-client",
                    "name": "Order DB Read Client",
                    "protocol": "JDBC",
                    "description": "Reads from the replica database."
                },
                {
                    "unique-id": "payment-publisher",
                    "protocol": "AMQP",
                    "description": "Publishes order messages for payment processing."
                },
                {
                    "unique-id": "order-inventory-client",
                    "protocol": "REST",
                    "description": "Outbound connection to check inventory"
                },
                {
                    "unique-id": "order-health",
                    "name": "Health Check",
                    "protocol": "HTTP",
                    "path": "/health"
                }
            ]
        },
        {
            "unique-id": "inventory-service",
            "node-type": "service",
            "name": "Inventory Service",
            "description": "Manages product stock levels.",
            "metadata": {
                "tech-owner": "Warehouse Team",
                "repository": "https://github.com/example/inventory-service",
                "deployment-type": "container",
                "business-criticality": "high"
            },
            "interfaces": [
                {
                    "unique-id": "inventory-api",
                    "name": "Inventory API",
                    "protocol": "REST",
                    "port": 8081
                },
                {
                    "unique-id": "inventory-db-client",
                    "protocol": "JDBC"
                },
                {
                    "unique-id": "inventory-health",
                    "name": "Health Check",
                    "protocol": "HTTP",
                    "path": "/health"
                }
            ]
        },
        {
            "unique-id": "payment-service",
            "node-type": "service",
            "name": "Payment Service",
            "description": "Integrates with external payment providers.",
            "metadata": {
                "tech-owner": "Payment Team",
                "repository": "https://github.com/example/payment-service",
                "deployment-type": "serverless",
                "business-criticality": "high"
            },
            "controls": {
                "compliance": {
                    "description": "PCI-DSS compliance for payment processing",
                    "requirements": [
                        {
                            "requirement-url": "https://www.pcisecuritystandards.org/documents/PCI-DSS-v4.0",
                            "config-url": "https://configs.example.com/compliance/pci-dss-config.json"
                        }
                    ]
                }
            },
            "interfaces": [
                {
                    "unique-id": "payment-api",
                    "name": "Payment Processing API",
                    "protocol": "REST",
                    "port": 8082
                },
                {
                    "unique-id": "payment-consumer",
                    "protocol": "AMQP",
                    "description": "Consumes order messages for payment processing."
                },
                {
                    "unique-id": "payment-health",
                    "name": "Health Check",
                    "protocol": "HTTP",
                    "path": "/health"
                }
            ]
        },
        {
            "unique-id": "message-broker",
            "node-type": "system",
            "name": "Message Broker (RabbitMQ)",
            "description": "Central messaging system for failure isolation and async processing.",
            "metadata": {
                "tech-owner": "Platform Team",
                "deployment-type": "managed-service",
                "adr": "docs/adr/0001-use-message-queue-for-async-processing.md"
            },
            "interfaces": [
                {
                    "unique-id": "amqp-port",
                    "protocol": "AMQP",
                    "port": 5672
                }
            ]
        },
        {
            "unique-id": "order-queue",
            "node-type": "queue",
            "name": "Order Payment Queue",
            "description": "Buffer for orders awaiting payment processing."
        },
        {
            "unique-id": "order-database-cluster",
            "node-type": "system",
            "name": "Order Database Cluster",
            "description": "High-availability database cluster for order data.",
            "controls": {
                "failover": {
                    "description": "Disaster recovery and failover targets",
                    "requirements": [
                        {
                            "requirement-url": "https://internal-policy.example.com/resilience/disaster-recovery-targets",
                            "config": {
                                "rto-minutes": 15,
                                "rpo-minutes": 5,
                                "automatic-failover": true
                            }
                        }
                    ]
                }
            }
        },
        {
            "unique-id": "order-database-primary",
            "node-type": "database",
            "name": "Order Database (Primary)",
            "description": "Main writable database for orders.",
            "metadata": {
                "tech-owner": "DBA Team",
                "deployment-type": "managed-service",
                "data-classification": "PII",
                "role": "primary",
                "replication-mode": "async"
            },
            "interfaces": [
                {
                    "unique-id": "order-sql-primary",
                    "protocol": "JDBC",
                    "host": "orders-primary.example.com",
                    "port": 5432,
                    "database": "orders_v1"
                }
            ]
        },
        {
            "unique-id": "order-database-replica",
            "node-type": "database",
            "name": "Order Database (Replica)",
            "description": "Read-only replica for scaling read operations.",
            "metadata": {
                "tech-owner": "DBA Team",
                "deployment-type": "managed-service",
                "data-classification": "PII",
                "role": "replica",
                "replication-mode": "async"
            },
            "interfaces": [
                {
                    "unique-id": "order-sql-replica",
                    "protocol": "JDBC",
                    "host": "orders-replica.example.com",
                    "port": 5432,
                    "database": "orders_v1"
                }
            ]
        },
        {
            "unique-id": "inventory-db",
            "node-type": "database",
            "name": "Inventory Database",
            "description": "Stores stock levels.",
            "metadata": {
                "tech-owner": "DBA Team",
                "deployment-type": "managed-service"
            },
            "interfaces": [
                {
                    "unique-id": "inventory-sql",
                    "protocol": "JDBC",
                    "host": "inventory-db.example.com",
                    "port": 5432,
                    "database": "inventory_v1"
                }
            ]
        }
    ],
    "relationships": [
        {
            "unique-id": "customer-interacts-lb",
            "description": "Customer accesses the platform via Load Balancer.",
            "relationship-type": {
                "interacts": {
                    "actor": "customer",
                    "nodes": ["load-balancer"]
                }
            }
        },
        {
            "unique-id": "admin-interacts-lb",
            "description": "Admin manages the platform via Load Balancer.",
            "relationship-type": {
                "interacts": {
                    "actor": "admin",
                    "nodes": ["load-balancer"]
                }
            }
        },
        {
            "unique-id": "lb-connects-gateway-1",
            "description": "Load Balancer distributes traffic to Gateway Instance 1.",
            "relationship-type": {
                "connects": {
                    "source": { "node": "load-balancer", "interfaces": ["lb-to-gateway"] },
                    "destination": { "node": "api-gateway-1", "interfaces": ["gateway-1-http"] }
                }
            }
        },
        {
            "unique-id": "lb-connects-gateway-2",
            "description": "Load Balancer distributes traffic to Gateway Instance 2.",
            "relationship-type": {
                "connects": {
                    "source": { "node": "load-balancer", "interfaces": ["lb-to-gateway"] },
                    "destination": { "node": "api-gateway-2", "interfaces": ["gateway-2-http"] }
                }
            }
        },
        {
            "unique-id": "gateway-1-connects-order",
            "description": "Gateway 1 forwards requests to Order Service.",
            "relationship-type": {
                "connects": {
                    "source": { "node": "api-gateway-1", "interfaces": ["order-client-1"] },
                    "destination": { "node": "order-service", "interfaces": ["order-api"] }
                }
            }
        },
        {
            "unique-id": "gateway-2-connects-order",
            "description": "Gateway 2 forwards requests to Order Service.",
            "relationship-type": {
                "connects": {
                    "source": { "node": "api-gateway-2", "interfaces": ["order-client-2"] },
                    "destination": { "node": "order-service", "interfaces": ["order-api"] }
                }
            }
        },
        {
            "unique-id": "gateway-1-connects-inventory",
            "description": "Gateway 1 forwards requests to Inventory Service.",
            "relationship-type": {
                "connects": {
                    "source": { "node": "api-gateway-1", "interfaces": ["inventory-client-1"] },
                    "destination": { "node": "inventory-service", "interfaces": ["inventory-api"] }
                }
            }
        },
        {
            "unique-id": "gateway-2-connects-inventory",
            "description": "Gateway 2 forwards requests to Inventory Service.",
            "relationship-type": {
                "connects": {
                    "source": { "node": "api-gateway-2", "interfaces": ["inventory-client-2"] },
                    "destination": { "node": "inventory-service", "interfaces": ["inventory-api"] }
                }
            }
        },
        {
            "unique-id": "order-connects-primary-db",
            "description": "Order Service persists data to Primary Order Database.",
            "metadata": {
                "monitoring": true
            },
            "relationship-type": {
                "connects": {
                    "source": { "node": "order-service", "interfaces": ["order-db-write-client"] },
                    "destination": { "node": "order-database-primary", "interfaces": ["order-sql-primary"] }
                }
            }
        },
        {
            "unique-id": "order-publishes-to-queue",
            "description": "Order Service publishes payment task to queue.",
            "protocol": "AMQP",
            "relationship-type": {
                "connects": {
                    "source": { "node": "order-service", "interfaces": ["payment-publisher"] },
                    "destination": { "node": "order-queue" }
                }
            }
        },
        {
            "unique-id": "payment-subscribes-to-queue",
            "description": "Payment Service consumes payment task from queue.",
            "protocol": "AMQP",
            "relationship-type": {
                "connects": {
                    "source": { "node": "order-queue" },
                    "destination": { "node": "payment-service", "interfaces": ["payment-consumer"] }
                }
            }
        },
        {
            "unique-id": "order-connects-replica-db",
            "description": "Order Service reads data from Replica Order Database.",
            "metadata": {
                "monitoring": true
            },
            "relationship-type": {
                "connects": {
                    "source": { "node": "order-service", "interfaces": ["order-db-read-client"] },
                    "destination": { "node": "order-database-replica", "interfaces": ["order-sql-replica"] }
                }
            }
        },
        {
            "unique-id": "order-connects-inventory",
            "description": "Order Service checks/reserves stock in Inventory Service.",
            "metadata": {
                "latency-sla": "< 100ms",
                "monitoring": true,
                "circuit-breaker": true
            },
            "relationship-type": {
                "connects": {
                    "source": { "node": "order-service", "interfaces": ["order-inventory-client"] },
                    "destination": { "node": "inventory-service", "interfaces": ["inventory-api"] }
                }
            }
        },
        {
            "unique-id": "inventory-connects-db",
            "description": "Inventory Service manages stock in Inventory Database.",
            "metadata": {
                "monitoring": true
            },
            "relationship-type": {
                "connects": {
                    "source": { "node": "inventory-service", "interfaces": ["inventory-db-client"] },
                    "destination": { "node": "inventory-db", "interfaces": ["inventory-sql"] }
                }
            }
        },
        {
            "unique-id": "broker-composition",
            "description": "Message broker contains the order queue.",
            "relationship-type": {
                "composed-of": {
                    "container": "message-broker",
                    "nodes": ["order-queue"]
                }
            }
        },
        {
            "unique-id": "order-db-composition",
            "description": "Primary and replica databases form the order database cluster.",
            "relationship-type": {
                "composed-of": {
                    "container": "order-database-cluster",
                    "nodes": [
                        "order-database-primary",
                        "order-database-replica"
                    ]
                }
            }
        },
        {
            "unique-id": "ecommerce-system-composition",
            "description": "The E-Commerce Platform comprises its core services and databases.",
            "relationship-type": {
                "composed-of": {
                    "container": "ecommerce-system",
                    "nodes": [
                        "load-balancer",
                        "api-gateway-1",
                        "api-gateway-2",
                        "order-service",
                        "inventory-service",
                        "payment-service",
                        "order-database-cluster",
                        "inventory-db",
                        "message-broker"
                    ]
                }
            }
        }
    ]
}
